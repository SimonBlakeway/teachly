<link rel="stylesheet" href="/css/login.css">


<section id="login" class="d-flex justify-content-center align-items-center">
  <section id="form-section" class="row container p-1 py-4 m-0" style="max-width: 600px;">
    <div class="col-12 p-md-5" id="login-form-col">
      <form onsubmit="return false">
        <div class="row py-3 d-flex justify-content-center align-items-center">
          <div class="col" style="min-width: 200px; max-width: 300px;">
            <label class="form-label text" for="firstName">{{context.bodyContext.fullName}}</label>
            <input required type="text" id="username"
              class="form-control form-control-md border border-info rounded login-input" />
          </div>
          <div class="col" style="min-width: 200px; max-width: 300px;">
            <label class="form-label text" for="password">{{context.bodyContext.password}}</label>
            <input required type="password" id="password"
              class="form-control form-control-md border border-info rounded login-input" />
          </div>
        </div>
        <div class="row">
          <div class="col-12 mb-4">
            <div class="form-ch-eck d-flex justify-content-center mb-4">
              <label class="form-check-label" style="text-align: center;">
                {{context.bodyContext.IAgreeTo}} <a href="\termsofservice"
                  class="text-body"><u>{{context.bodyContext.TOS}}</u></a>
              </label>
            </div>
            <div class="d-flex justify-content-center">
              <button type='submit' onclick="sendloginReq()"
                class="btn btn-outline-primary btn-lg">
                {{context.bodyContext.LOGIN}}</button>
            </div>
            <div>

              <p>
              <div id="sign-in-with-oauth" class="section" style="text-align: center;">
                <a href="/auth/google" class="btn red darken-1" style="width: 200px;">
                  <i class="fab fa-google left"></i> Log In With Google
                </a>
                <a href="/auth/facebook" class="btn blue darken-2" style="width: 200px;">
                  <i class="fab fa-facebook left fa-small"></i> Log In With Facebook
                </a>
              </div>
              </p>
            </div>
            <p class="text-center text-muted mt-5 mb-0 fw-bold text-body">
              {{context.bodyContext.dontHaveAccount}} <a href="\login">
                <u>{{context.bodyContext.createOne}}</u></a>
            </p>
          </div>
        </div>
      </form>
    </div>
  </section>

  <div id="err-popup" class="popup">
    <div id="password-err">{{context.bodyContext.errPopup.passwordErr}}</div>
    <div id="name-err">{{context.bodyContext.errPopup.nameErr}}</div>
  </div>

  <script>
    sendloginReq = async function () {
      try {
        name = $("#username").val()
        password = $("#password").val()
        if (name == "" || password == "") { return }
        formData = {
          'name': name,
          'password': password,
        }
        res = await axios({
          method: 'post',
          url: '/auth/login',
          data: formData,
          headers: {
            'Content-Type': 'application/json',
          },
        })
        if (res.data.err) {
          $("#err-popup").attr("display", "grid");
          document.getElementById("err-popup").style.display = "grid";
          if (res.data.err == "invalid name") {
            $('#name-err').show();
            $('#password-err').hide();
            setTimeout(function () {
              $('#err-popup').fadeOut('fast')
            }, 1000);
          }
          if (res.data.err == "invalid password") {
            $('#name-err').hide();
            $('#password-err').show();
            setTimeout(function () {
              $('#err-popup').fadeOut('fast')
            }, 1000);
          }
        }
        else { window.location = "/" }
      }
      catch (err) { console.log(err) }
    }
  </script>
</section>